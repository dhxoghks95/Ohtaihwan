<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.72.0" />

  <title>Random Forest &middot; 오! 데이터 사이언스</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="Random Forest">
<meta itemprop="description" content="0) Importing Packages &amp; Data , EDAlibrary(tidyverse)## Warning: 패키지 &#39;tidyverse&#39;는 R 버전 3.">
<meta itemprop="datePublished" content="2020-06-17T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-06-17T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1181">



<meta itemprop="keywords" content="R,Datamining,Decision Tree," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Random Forest"/>
<meta name="twitter:description" content="0) Importing Packages &amp; Data , EDAlibrary(tidyverse)## Warning: 패키지 &#39;tidyverse&#39;는 R 버전 3."/>


<meta property="og:title" content="Random Forest" />
<meta property="og:description" content="0) Importing Packages &amp; Data , EDAlibrary(tidyverse)## Warning: 패키지 &#39;tidyverse&#39;는 R 버전 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2020/06/17/random-forest/" />
<meta property="article:published_time" content="2020-06-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-17T00:00:00+00:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
      

      <h1>오! 데이터 사이언스</h1>

      
      <p class="lead">Oh! Blog</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/about/">About</a>
        </li><li>
          <a href="https://github.com/dhxoghks95">GitHub</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>Random Forest</h1>

  <div class="post-date">
    <time datetime="2020-06-17T00:00:00Z">Jun 17, 2020</time> &middot; 6 min read
  </div>

  


<div id="importing-packages-data-eda" class="section level1">
<h1>0) Importing Packages &amp; Data , EDA</h1>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: 패키지 &#39;tidyverse&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## -- Attaching packages ------------------------------------------------------ tidyverse 1.3.0 --</code></pre>
<pre><code>## √ ggplot2 3.3.1     √ purrr   0.3.4
## √ tibble  3.0.1     √ dplyr   1.0.0
## √ tidyr   1.1.0     √ stringr 1.4.0
## √ readr   1.3.1     √ forcats 0.5.0</code></pre>
<pre><code>## Warning: 패키지 &#39;tibble&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;tidyr&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;purrr&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;forcats&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## -- Conflicts --------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(tidymodels)</code></pre>
<pre><code>## Warning: 패키지 &#39;tidymodels&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## -- Attaching packages ----------------------------------------------------- tidymodels 0.1.0 --</code></pre>
<pre><code>## √ broom     0.5.6      √ rsample   0.0.6 
## √ dials     0.0.6      √ tune      0.1.0 
## √ infer     0.5.1      √ workflows 0.1.1 
## √ parsnip   0.1.1      √ yardstick 0.0.6 
## √ recipes   0.1.12</code></pre>
<pre><code>## Warning: 패키지 &#39;broom&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;dials&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;scales&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;infer&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;parsnip&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;recipes&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;rsample&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;tune&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;workflows&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Warning: 패키지 &#39;yardstick&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## -- Conflicts -------------------------------------------------------- tidymodels_conflicts() --
## x scales::discard() masks purrr::discard()
## x dplyr::filter()   masks stats::filter()
## x recipes::fixed()  masks stringr::fixed()
## x dplyr::lag()      masks stats::lag()
## x dials::margin()   masks ggplot2::margin()
## x yardstick::spec() masks readr::spec()
## x recipes::step()   masks stats::step()</code></pre>
<pre class="r"><code>library(pROC)</code></pre>
<pre><code>## Warning: 패키지 &#39;pROC&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## Type &#39;citation(&quot;pROC&quot;)&#39; for a citation.</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;pROC&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cov, smooth, var</code></pre>
<pre class="r"><code>library(randomForest)</code></pre>
<pre><code>## Warning: 패키지 &#39;randomForest&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre><code>## randomForest 4.6-14</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;randomForest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dials&#39;:
## 
##     margin</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     margin</code></pre>
<pre class="r"><code>library(plot3D)</code></pre>
<pre><code>## Warning: 패키지 &#39;plot3D&#39;는 R 버전 3.6.3에서 작성되었습니다</code></pre>
<pre class="r"><code>data = read_csv(&quot;data/pulsar_stars.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   `Mean of the integrated profile` = col_double(),
##   `Standard deviation of the integrated profile` = col_double(),
##   `Excess kurtosis of the integrated profile` = col_double(),
##   `Skewness of the integrated profile` = col_double(),
##   `Mean of the DM-SNR curve` = col_double(),
##   `Standard deviation of the DM-SNR curve` = col_double(),
##   `Excess kurtosis of the DM-SNR curve` = col_double(),
##   `Skewness of the DM-SNR curve` = col_double(),
##   target_class = col_double()
## )</code></pre>
<pre class="r"><code>head(data)</code></pre>
<pre><code>## # A tibble: 6 x 9
##   `Mean of the in~ `Standard devia~ `Excess kurtosi~ `Skewness of th~
##              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1            141.              55.7          -0.235            -0.700
## 2            103.              58.9           0.465            -0.515
## 3            103.              39.3           0.323             1.05 
## 4            137.              57.2          -0.0684           -0.636
## 5             88.7             40.7           0.601             1.12 
## 6             93.6             46.7           0.532             0.417
## # ... with 5 more variables: `Mean of the DM-SNR curve` &lt;dbl&gt;, `Standard
## #   deviation of the DM-SNR curve` &lt;dbl&gt;, `Excess kurtosis of the DM-SNR
## #   curve` &lt;dbl&gt;, `Skewness of the DM-SNR curve` &lt;dbl&gt;, target_class &lt;dbl&gt;</code></pre>
<div id="이-데이터는-pulsar-star를-찾는-데이터셋이다.-pulsar-star란-전자기파-광선을-뿜는-자전하는-중성자별이라고-한다.-target_class가-1이면-pulsar-star고-0이면-일반-별이다." class="section level2">
<h2>이 데이터는 Pulsar Star를 찾는 데이터셋이다. Pulsar star란 전자기파 광선을 뿜는 자전하는 중성자별이라고 한다. target_class가 1이면 Pulsar star고 0이면 일반 별이다.</h2>
<pre class="r"><code>skimr::skim(data)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-2">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">17898</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">9</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mean of the integrated profile</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">111.08</td>
<td align="right">25.65</td>
<td align="right">5.81</td>
<td align="right">100.93</td>
<td align="right">115.08</td>
<td align="right">127.09</td>
<td align="right">192.62</td>
<td align="left">▁▁▇▇▁</td>
</tr>
<tr class="even">
<td align="left">Standard deviation of the integrated profile</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">46.55</td>
<td align="right">6.84</td>
<td align="right">24.77</td>
<td align="right">42.38</td>
<td align="right">46.95</td>
<td align="right">51.02</td>
<td align="right">98.78</td>
<td align="left">▂▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Excess kurtosis of the integrated profile</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.48</td>
<td align="right">1.06</td>
<td align="right">-1.88</td>
<td align="right">0.03</td>
<td align="right">0.22</td>
<td align="right">0.47</td>
<td align="right">8.07</td>
<td align="left">▅▇▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Skewness of the integrated profile</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.77</td>
<td align="right">6.17</td>
<td align="right">-1.79</td>
<td align="right">-0.19</td>
<td align="right">0.20</td>
<td align="right">0.93</td>
<td align="right">68.10</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Mean of the DM-SNR curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.61</td>
<td align="right">29.47</td>
<td align="right">0.21</td>
<td align="right">1.92</td>
<td align="right">2.80</td>
<td align="right">5.46</td>
<td align="right">223.39</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Standard deviation of the DM-SNR curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">26.33</td>
<td align="right">19.47</td>
<td align="right">7.37</td>
<td align="right">14.44</td>
<td align="right">18.46</td>
<td align="right">28.43</td>
<td align="right">110.64</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Excess kurtosis of the DM-SNR curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.30</td>
<td align="right">4.51</td>
<td align="right">-3.14</td>
<td align="right">5.78</td>
<td align="right">8.43</td>
<td align="right">10.70</td>
<td align="right">34.54</td>
<td align="left">▂▇▂▁▁</td>
</tr>
<tr class="even">
<td align="left">Skewness of the DM-SNR curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">104.86</td>
<td align="right">106.51</td>
<td align="right">-1.98</td>
<td align="right">34.96</td>
<td align="right">83.06</td>
<td align="right">139.31</td>
<td align="right">1191.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">target_class</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.09</td>
<td align="right">0.29</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<div id="random-forest를-위해-변수명을-바꾸는-작업이-필요하다." class="section level2">
<h2>0-1) Random Forest를 위해 변수명을 바꾸는 작업이 필요하다.</h2>
<pre class="r"><code>colnames(data) = c(&quot;Mean_of_the_integrated_profile&quot;,&quot;Standard_deviation_of_the_integrated_profile&quot;,
                   &quot;Excess_kurtosis_of_the_integrated_profile&quot;,&quot;Skewness_of_the_integrated_profile&quot;,
                   &quot;Mean_of_the_DM_SNR_curve&quot;,&quot;Standard_deviation_of_the_DM_SNR_curve&quot;,
                   &quot;Excess_kurtosis_of_the_DM_SNR_curve&quot;,&quot;Skewness_of_the_DM_SNR_curve&quot;,&quot;target_class&quot; )</code></pre>
</div>
<div id="random-forest를-위해-target_class-변수를-factor로-바꿔주자" class="section level2">
<h2>0-2) Random Forest를 위해 target_class 변수를 factor로 바꿔주자</h2>
<pre class="r"><code>data$target_class = as.factor(data$target_class)</code></pre>
</div>
</div>
<div id="train-test-split" class="section level1">
<h1>1) Train-Test Split</h1>
<pre class="r"><code>set.seed(0226)
star_split &lt;- rsample::initial_split(data, prop = 0.5, strata = target_class)

train &lt;- training(star_split)
test &lt;- testing(star_split)

print(nrow(train))</code></pre>
<pre><code>## [1] 8949</code></pre>
<pre class="r"><code>print(nrow(test))</code></pre>
<pre><code>## [1] 8949</code></pre>
</div>
<div id="random-forest-modeling" class="section level1">
<h1>2) Random Forest Modeling</h1>
<pre class="r"><code>p = ncol(train) - 1 # class 뺀 X변수들의 숫자
n = nrow(train)

mtry = floor(seq(0.1, 1, by = 0.1) * p) 
nsize = round(c(1, n * seq(0.01, 0.1, by = 0.01)))

pna = matrix(NA, nrow = length(mtry), ncol = length(nsize))
pnadf = data.frame()

for( i in 1:length(mtry)){
  for( j in 1:length(nsize)){
    m = mtry[i]
    n = nsize[j]
    rf = randomForest(target_class~., 
                      data = train, ntree = 100, mtry = m, 
                      nodesize = n, set.seed(0226))
    pred = predict(rf, newdata = test, type = &#39;prob&#39;)
    
    roccurve0 = roc(test$target_class ~ pred[,2])

    auc = roccurve0$auc %&gt;% as.numeric()
    
    pna[i,j] = auc
    pnadf = rbind(pnadf, c(m,n,auc))
  }
}

rownames(pna) = mtry
colnames(pna) = nsize

pna</code></pre>
<pre><code>##           1        89       179       268       358       447       537
## 0 0.9655894 0.9478434 0.9514007 0.9489635 0.9482192 0.9526655 0.9480747
## 1 0.9655894 0.9478434 0.9514007 0.9489635 0.9482192 0.9526655 0.9480747
## 2 0.9658301 0.9545747 0.9501529 0.9506757 0.9499466 0.9527863 0.9425445
## 3 0.9672799 0.9502650 0.9495637 0.9495012 0.9497061 0.9484140 0.9440998
## 4 0.9648768 0.9487849 0.9530485 0.9451542 0.9483413 0.9450359 0.9446473
## 4 0.9648768 0.9487849 0.9530485 0.9451542 0.9483413 0.9450359 0.9446473
## 5 0.9678321 0.9556995 0.9489808 0.9474433 0.9456023 0.9461395 0.9421235
## 6 0.9678004 0.9523885 0.9511687 0.9407779 0.9421318 0.9456583 0.9436566
## 7 0.9651534 0.9533287 0.9447496 0.9446937 0.9436194 0.9438521 0.9458295
## 8 0.9669586 0.9510696 0.9443655 0.9332648 0.9322425 0.9249996 0.9302646
##         626       716       805       895
## 0 0.9497824 0.9510453 0.9502049 0.9364539
## 1 0.9497824 0.9510453 0.9502049 0.9364539
## 2 0.9383514 0.9507290 0.9505942 0.9487513
## 3 0.9393807 0.9404574 0.9345050 0.9449459
## 4 0.9392114 0.9394300 0.9411547 0.9422191
## 4 0.9392114 0.9394300 0.9411547 0.9422191
## 5 0.9393145 0.9383569 0.9352619 0.9372310
## 6 0.9368283 0.9326136 0.9399175 0.9374897
## 7 0.9453812 0.9360155 0.9294285 0.9285424
## 8 0.9213968 0.9208511 0.9205902 0.9200889</code></pre>
<div id="randomforest-과정중에-반복되는-메세지와-경고가-출력되어-rmarkdown에-messagefalse-warningfalse를-주어-생략하였다." class="section level3">
<h3>randomForest 과정중에 반복되는 메세지와 경고가 출력되어 rmarkdown에 message=FALSE, warning=FALSE를 주어 생략하였다.</h3>
</div>
<div id="위와-같은-mtrym-nodesize-auc-조합이-만들어졌다." class="section level3">
<h3>위와 같은 mtrym nodesize auc 조합이 만들어졌다.</h3>
</div>
</div>
<div id="d-surface-graph" class="section level1">
<h1>3) 3D Surface Graph</h1>
<pre class="r"><code>persp3D(mtry, nsize, pna, theta=110, phi=30, axes=TRUE,scale= 0.75, box=TRUE, nticks=5, 

        ticktype=&quot;detailed&quot;, xlab = &quot;mtry&quot;, ylab= &quot;nodesize&quot;, zlab = &quot;AUROC&quot;)</code></pre>
<p><img src="/post/2020-06-17-random-forest_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>colnames(pnadf) = c(&quot;mtry&quot;, &quot;nodesize&quot;, &quot;AUC&quot;)</code></pre>
<div id="그래프를-봤을-때-nodesize가-200-이하이고-mtry-가-5인-지점에서-가장-짙은-적색이-보이며-auc-약-0.97로-가장-높아보인다." class="section level3">
<h3>그래프를 봤을 때, nodesize가 200 이하이고, mtry 가 5인 지점에서 가장 짙은 적색이 보이며 AUC 약 0.97로 가장 높아보인다.</h3>
</div>
</div>
<div id="auc를-max로-하는-mtry과-nodesize-찾기" class="section level1">
<h1>4) AUC를 max로 하는 mtry과 nodesize 찾기</h1>
<pre class="r"><code>df = pnadf %&gt;%
  filter(AUC == max(AUC))

print(df)</code></pre>
<pre><code>##   mtry nodesize       AUC
## 1    5        1 0.9678321</code></pre>
<div id="그래프에서-봤던-대로-mtry가-5이고-nodesize가-1인-지점에서-auc-약-0.968로-가장-높았다." class="section level3">
<h3>그래프에서 봤던 대로 mtry가 5이고 nodesize가 1인 지점에서 AUC 약 0.968로 가장 높았다.</h3>
</div>
</div>

</div>


  </main>

  <footer>
  <div>
    &copy; Taihwan Oh 2020

    

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
